# 批量生成轨迹GIF动画指南

## 📋 概述

本指南将帮助你批量生成所有运动轨迹的GIF动画文件，这些GIF将在翻转卡片时显示，只包含纯净的轨迹动画和日期标题。

## 🎯 功能特点

- **纯净动画**：只包含轨迹动画和日期标题，无其他UI元素
- **批量生成**：一次性生成所有适合的轨迹GIF
- **自动下载**：生成的GIF文件自动下载到本地
- **智能筛选**：只处理单条轨迹的日期（多轨迹不适合GIF动画）

## 📊 数据统计

根据当前活动数据：
- 📈 总活动记录：920条
- 🗺️ 有轨迹的日期：775个
- 🎯 适合生成GIF的单轨迹日期：**745个**

## 🚀 使用步骤

### 1. 启动开发服务器
```bash
pnpm dev
# 或
npm run dev
```

### 2. 打开浏览器
访问 `http://localhost:5173`

### 3. 打开开发者工具
- Windows/Linux: `F12` 或 `Ctrl+Shift+I`
- macOS: `Cmd+Option+I`

### 4. 加载生成脚本
在控制台中输入以下命令加载脚本：
```javascript
// 加载GIF生成脚本
const script = document.createElement('script');
script.src = '/generateGifs.js';
document.head.appendChild(script);
```

### 5. 开始批量生成
等待脚本加载完成后，运行：
```javascript
generateTrackGifs()
```

### 6. 等待生成完成
- 脚本会自动处理所有745个单轨迹日期
- 每个GIF生成后会自动下载
- 控制台会显示实时进度
- 整个过程可能需要30-60分钟

### 7. 整理GIF文件
将下载的所有GIF文件移动到项目的 `assets/gif/` 目录下。

## 📁 文件命名规则

生成的GIF文件命名格式：
```
track_YYYY-MM-DD.gif
```

例如：
- `track_2024-01-15.gif`
- `track_2024-02-20.gif`

## 🎨 GIF规格

- **尺寸**：400x300像素
- **帧率**：约8-10 FPS
- **时长**：3-5秒（根据轨迹长度）
- **格式**：GIF动画
- **质量**：优化平衡（文件大小 vs 画质）

## 🔧 技术细节

### GIF生成参数
```javascript
{
  workers: 2,        // 使用2个worker加速生成
  quality: 8,        // 质量等级（1-30，数字越小质量越高）
  width: 400,        // 宽度
  height: 300,       // 高度
  workerScript: '/gif.worker.js'
}
```

### 动画参数
- **总帧数**：35帧
- **帧延迟**：120ms
- **最后一帧延迟**：1500ms（停留时间）

## 🚨 注意事项

1. **浏览器性能**：生成过程会占用较多CPU和内存
2. **网络稳定**：确保网络连接稳定，避免地图加载失败
3. **磁盘空间**：预留足够空间存储745个GIF文件（预计总大小约200-500MB）
4. **不要关闭页面**：生成过程中请保持浏览器页面打开

## 🐛 故障排除

### 常见问题

**Q: 脚本加载失败**
```
A: 确保开发服务器正在运行，并且可以访问 /generateGifs.js
```

**Q: GIF生成失败**
```
A: 检查控制台错误信息，可能是以下原因：
   - Mapbox token无效
   - 网络连接问题
   - 浏览器内存不足
```

**Q: 下载的文件不完整**
```
A: 某些浏览器可能限制自动下载，请检查下载设置
```

### 重新生成特定日期
如果某些GIF生成失败，可以单独重新生成：
```javascript
// 生成特定日期的GIF
const date = '2024-01-15';
const activity = activities.find(a => a.start_date_local.startsWith(date));
if (activity) {
  generateSingleGif(date, container, activity);
}
```

## 📈 性能优化建议

1. **分批处理**：如果一次性生成太多导致浏览器卡死，可以修改脚本分批处理
2. **降低质量**：如果文件太大，可以调整quality参数（增大数值）
3. **减少帧数**：可以减少totalFrames来加快生成速度

## 🎉 完成后

生成完成后：
1. 将所有GIF文件移动到 `assets/gif/` 目录
2. 重启开发服务器
3. 翻转卡片时将显示预生成的GIF动画

## 📞 技术支持

如果遇到问题，请检查：
1. 浏览器控制台的错误信息
2. 网络连接状态
3. 磁盘空间是否充足
4. Mapbox API配置是否正确